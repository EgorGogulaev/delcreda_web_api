<form
    method="POST"
    action="{{app_url}}/confirmation_v2/{{unique_path}}"
    id="password-form"
>
    <div class="form-group">
        <label for="new_password">Новый пароль:</label>
        <input
            type="password"
            id="new_password"
            name="new_password"
            required
            minlength="8"
            maxlength="240"
            class="form-control"
        />
    </div>

    <div class="form-group">
        <label for="confirm_password">Повторите пароль:</label>
        <input
            type="password"
            id="confirm_password"
            required
            class="form-control"
        />
        <small class="text-danger" id="password-error" style="display: none">
            Пароли не совпадают
        </small>
    </div>

    <button type="submit" id="submit-btn" class="btn btn-primary">
        Сменить пароль
    </button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        const errorMessage = document.getElementById('password-error');
        const submitBtn = document.getElementById('submit-btn');
        const form = document.getElementById('password-form');

        function validatePasswords() {
            if (newPassword.value !== confirmPassword.value) {
                errorMessage.style.display = 'block';
                submitBtn.disabled = true;
                return false;
            } else {
                errorMessage.style.display = 'none';
                submitBtn.disabled = false;
                return true;
            }
        }

        newPassword.addEventListener('input', validatePasswords);
        confirmPassword.addEventListener('input', validatePasswords);

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            if (!validatePasswords()) {
                return false;
            }

            const formData = new FormData();
            formData.append('new_password', newPassword.value);

            fetch(form.action, {
                method: 'POST',
                body: formData,
            })
                .then((response) => {
                    if (response.ok) {
                        return response.text(); // Получаем HTML ответ
                    } else {
                        throw new Error('Ошибка сервера');
                    }
                })
                .then((html) => {
                    // Заменяем всю страницу на HTML из ответа
                    document.documentElement.innerHTML = html;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Ошибка при отправке формы');
                });
        });
    });
</script>
